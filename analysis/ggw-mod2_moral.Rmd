---
title: 'GGW-mod2: Moral Followup (to Study 1)'
output:
  html_document:
    theme: flatly
    toc: yes
  pdf_document:
    toc: yes
---

# Setup

```{r workspace setup, message = F, echo = F}
# load libraries
library(devtools)
library(psych)
library(stats)
# library(lavaan)
# library(nonnest2)
# library(nFactors)
library(langcog)
# library(directlabels)
library(ggplot2)
library(knitr)
library(tidyr)
library(dplyr)
library(gridExtra)
library(robustHD)
library(lme4)
# library(ordinal)

# clear workspace
rm(list = ls(all = T))
graphics.off()
```

```{r functions, message = F, echo = F}
# make na.rm = T versions of summary functions
mean_na <- function(x) {mean(x, na.rm = T)}
ci_lower_na <- function(x) {quantile(x, 0.025, na.rm = T)}
ci_upper_na <- function(x) {quantile(x, 0.975, na.rm = T)}

# make cleanup function
cleanup <- function(datasource) {
  if(datasource %in% c("study 1", "study 2")) {
    
    # set target dataset
    if(datasource == "study 1"){d <- d_raw_study1}
    if(datasource == "study 2"){d <- d_raw_study2}
    
    # enact exclusionary criteria
    d_clean_1 <- d %>%
      mutate(finished_mod = ifelse(is.na(CATCH), 0,
                                   ifelse(finished == 1, 1,
                                          0.5))) %>%
      filter(CATCH == 1, # exclude Ps who fail catch trials 
             finished_mod != 0) %>% # exclude Ps who did not complete task
      mutate(yob_correct = as.numeric(
        ifelse(as.numeric(as.character(yob)) > 1900 & 
                 as.numeric(as.character(yob)) < 2000, 
               as.numeric(as.character(yob)), NA)), # correct formatting in yob
        age_approx = 2016 - yob_correct) %>% # calculate approximate age
      mutate(gender = factor(gender, levels = c(1, 2, 0), 
                             labels = c("m", "f", "other"))) %>%
      filter(age_approx >= 18) # exclude Ps who are younger than 18 years
    
    # recode background and demographic variables
    d_clean <- d_clean_1 %>%
      mutate( # deal with study number
        study = factor(study)) %>%
      mutate( # deal with study duration
        duration = as.numeric(difftime(strptime(end_time, "%I:%M:%S"),
                                       strptime(start_time, "%I:%M:%S"),
                                       units = "mins"))) %>%
      mutate( # deal with race
        race_asian_east = 
          factor(ifelse(is.na(race_asian_east), "", "asian_east ")),
        race_asian_south = 
          factor(ifelse(is.na(race_asian_south), "", "asian_south ")),
        race_asian_other = 
          factor(ifelse(is.na(race_asian_other), "", "asian_other ")),
        race_black = 
          factor(ifelse(is.na(race_black), "", "black ")),
        race_hispanic = 
          factor(ifelse(is.na(race_hispanic), "", "hispanic ")),
        race_middle_eastern = 
          factor(ifelse(is.na(race_middle_eastern), "", "middle_eastern ")),
        race_native_american = 
          factor(ifelse(is.na(race_native_american), "", "native_american ")),
        race_pac_islander = 
          factor(ifelse(is.na(race_pac_islander), "", "pac_islander ")),
        race_white = 
          factor(ifelse(is.na(race_white), "", "white ")),
        race_other_prefno = 
          factor(ifelse(is.na(race_other_prefno), "", "other_prefno ")),
        race_cat = paste0(race_asian_east, race_asian_south, race_asian_other,
                          race_black, race_hispanic, race_middle_eastern,
                          race_native_american, race_pac_islander, race_white,
                          race_other_prefno),
        race_cat2 = factor(sub(" +$", "", race_cat)),
        race_cat3 = factor(ifelse(grepl(" ", race_cat2) == T, "multiracial",
                                  as.character(race_cat2)))) %>%
      select(study, subid:end_time, duration, finished:gender, 
             religion_buddhism:age_approx, race_cat3) %>%
      rename(race_cat = race_cat3) %>%
      mutate( # deal with religion
        religion_buddhism = 
          factor(ifelse(is.na(religion_buddhism), "", "buddhism ")),
        religion_christianity = 
          factor(ifelse(is.na(religion_christianity), "", "christianity ")),
        religion_hinduism = 
          factor(ifelse(is.na(religion_hinduism), "", "hinduism ")),
        religion_islam = 
          factor(ifelse(is.na(religion_islam), "", "islam ")),
        religion_jainism = 
          factor(ifelse(is.na(religion_jainism), "", "jainism ")),
        religion_judaism = 
          factor(ifelse(is.na(religion_judaism), "", "judaism ")),
        religion_sikhism = 
          factor(ifelse(is.na(religion_sikhism), "", "sikhism ")),
        religion_other = 
          factor(ifelse(is.na(religion_other), "", "other ")),
        religion_none = 
          factor(ifelse(is.na(religion_none), "", "none ")),
        religion_prefno = 
          factor(ifelse(is.na(religion_prefno), "", "other_prefno ")),
        religion_cat = paste0(religion_buddhism, religion_christianity, 
                              religion_hinduism, religion_islam, 
                              religion_jainism, religion_judaism, 
                              religion_sikhism, religion_other, 
                              religion_none, religion_prefno),
        religion_cat2 = factor(sub(" +$", "", religion_cat)),
        religion_cat3 = factor(ifelse(grepl(" ", religion_cat2) == T, 
                                      "multireligious",
                                      as.character(religion_cat2)))) %>%
      select(study:gender, feedback:race_cat, religion_cat3) %>%
      rename(religion_cat = religion_cat3)
    
    # remove extraneous dfs and variables
    rm(d, d_clean_1)
  }
  
  if(datasource == "study 3") {
    
    # set target dataset
    d <- d_raw_study3
    
    # enact exclusionary criteria
    d_clean_1 <- d %>%
      mutate(finished_mod = ifelse(is.na(CATCH..characterL) | 
                                     is.na(CATCH..characterR), 0,
                                   ifelse(finished == 1, 1,
                                          0.5))) %>%
      filter(CATCH..characterL == 5, # exclude Ps who fail catch trials 
             CATCH..characterR == 5,
             finished_mod != 0) %>% # exclude Ps who did not complete task
      mutate(yob_correct = as.numeric(
        ifelse(as.numeric(as.character(yob)) > 1900 & 
                 as.numeric(as.character(yob)) < 2000, 
               as.numeric(as.character(yob)), NA)), # correct formatting in yob
        age_approx = 2016 - yob_correct) %>% # calculate approximate age
      mutate(gender = factor(gender, levels = c(1, 2, 0), 
                             labels = c("m", "f", "other"))) %>%
      filter(age_approx >= 18) # exclude Ps who are younger than 18 years
    
    # recode background and demographic variables
    d_clean_2 <- d_clean_1 %>%
      mutate( # deal with study number
        study = factor(study)) %>%
      mutate( # deal with study duration
        duration = as.numeric(difftime(strptime(end_time, "%I:%M:%S"),
                                       strptime(start_time, "%I:%M:%S"),
                                       units = "mins"))) %>%
      mutate( # deal with race
        race_asian_east = 
          factor(ifelse(is.na(race_asian_east), "", "asian_east ")),
        race_asian_south = 
          factor(ifelse(is.na(race_asian_south), "", "asian_south ")),
        race_asian_other = 
          factor(ifelse(is.na(race_asian_other), "", "asian_other ")),
        race_black = 
          factor(ifelse(is.na(race_black), "", "black ")),
        race_hispanic = 
          factor(ifelse(is.na(race_hispanic), "", "hispanic ")),
        race_middle_eastern = 
          factor(ifelse(is.na(race_middle_eastern), "", "middle_eastern ")),
        race_native_american = 
          factor(ifelse(is.na(race_native_american), "", "native_american ")),
        race_pac_islander = 
          factor(ifelse(is.na(race_pac_islander), "", "pac_islander ")),
        race_white = 
          factor(ifelse(is.na(race_white), "", "white ")),
        race_other_prefno = 
          factor(ifelse(is.na(race_other_prefno), "", "other_prefno ")),
        race_cat = paste0(race_asian_east, race_asian_south, race_asian_other,
                          race_black, race_hispanic, race_middle_eastern,
                          race_native_american, race_pac_islander, race_white,
                          race_other_prefno),
        race_cat2 = factor(sub(" +$", "", race_cat)),
        race_cat3 = factor(ifelse(grepl(" ", race_cat2) == T, "multiracial",
                                  as.character(race_cat2)))) %>%
      select(study, subid:end_time, duration, finished:gender, 
             religion_buddhism:age_approx, race_cat3) %>%
      rename(race_cat = race_cat3) %>%
      mutate( # deal with religion
        religion_buddhism = 
          factor(ifelse(is.na(religion_buddhism), "", "buddhism ")),
        religion_christianity = 
          factor(ifelse(is.na(religion_christianity), "", "christianity ")),
        religion_hinduism = 
          factor(ifelse(is.na(religion_hinduism), "", "hinduism ")),
        religion_islam = 
          factor(ifelse(is.na(religion_islam), "", "islam ")),
        religion_jainism = 
          factor(ifelse(is.na(religion_jainism), "", "jainism ")),
        religion_judaism = 
          factor(ifelse(is.na(religion_judaism), "", "judaism ")),
        religion_sikhism = 
          factor(ifelse(is.na(religion_sikhism), "", "sikhism ")),
        religion_other = 
          factor(ifelse(is.na(religion_other), "", "other ")),
        religion_none = 
          factor(ifelse(is.na(religion_none), "", "none ")),
        religion_prefno = 
          factor(ifelse(is.na(religion_prefno), "", "other_prefno ")),
        religion_cat = paste0(religion_buddhism, religion_christianity, 
                              religion_hinduism, religion_islam, 
                              religion_jainism, religion_judaism, 
                              religion_sikhism, religion_other, 
                              religion_none, religion_prefno),
        religion_cat2 = factor(sub(" +$", "", religion_cat)),
        religion_cat3 = factor(ifelse(grepl(" ", religion_cat2) == T, 
                                      "multireligious",
                                      as.character(religion_cat2)))) %>%
      select(study:gender, feedback:race_cat, religion_cat3) %>%
      rename(religion_cat = religion_cat3)
    
    # rename response variables
    d_clean_3 <- d_clean_2
    names(d_clean_3) <- gsub("get", "", names(d_clean_3))
    names(d_clean_3) <- gsub("\\.", "", names(d_clean_3))
    names(d_clean_3) <- gsub("char", "_char", names(d_clean_3))
    names(d_clean_3)[names(d_clean_3) %in% c("_characterL", "_characterR")] <- 
      c("characterL", "characterR")
    
    # recode response variables (center)
    d_clean_4 <- d_clean_3
    for(i in 11:92) {
      d_clean_4[,i] <- d_clean_4[,i] - 4 # transform from 1 to 7 --> -3 to 3
    }
    
    # recode characterL vs. characterR as beetle vs. robot
    d_clean_5_demo <- d_clean_4 %>%
      select(study:condition, yob:religion_cat)
    
    d_clean_5_characterL <- d_clean_4 %>%
      mutate(target = characterL) %>%
      select(study, subid, target, happy_characterL:CATCH_characterL)
    names(d_clean_5_characterL) <- gsub("_characterL", "", 
                                        names(d_clean_5_characterL))
    
    d_clean_5_characterR <- d_clean_4 %>%
      mutate(target = characterR) %>%
      select(study, subid, target, happy_characterR:CATCH_characterR)
    names(d_clean_5_characterR) <- gsub("_characterR", "", 
                                        names(d_clean_5_characterR))
    
    d_clean <- d_clean_5_characterL %>%
      full_join(d_clean_5_characterR) %>%
      full_join(d_clean_5_demo) %>%
      select(study, subid, date:religion_cat, target:CATCH)
    
    # remove extraneous dfs and variables
    rm(d, d_clean_1, d_clean_2, d_clean_3, d_clean_4, d_clean_5_characterL, 
       d_clean_5_characterR, d_clean_5_demo, i)
  }
  
  if(datasource == "study 4") {
    
    # set target dataset
    d <- d_raw_study4

        # enact exclusionary criteria
    d_clean_1 <- d %>%
      mutate(finished_mod = ifelse(is.na(CATCH), 0,
                                   ifelse(finished == 1, 1,
                                          0.5))) %>%
      filter(CATCH == 1, # exclude Ps who fail catch trials 
             finished_mod != 0) %>% # exclude Ps who did not complete task
      mutate(yob_correct = as.numeric(
        ifelse(as.numeric(as.character(yob)) > 1900 & 
                 as.numeric(as.character(yob)) < 2000, 
               as.numeric(as.character(yob)), NA)), # correct formatting in yob
        age_approx = 2016 - yob_correct) %>% # calculate approximate age
      mutate(gender = factor(gender, levels = c(1, 2, 0), 
                             labels = c("m", "f", "other"))) %>%
      filter(age_approx >= 18) # exclude Ps who are younger than 18 years
    
    # recode one character
    d_clean_2 <- d_clean_1 %>%
      mutate(condition = factor(ifelse(
        grepl("vegetative", as.character(condition)), "pvs",
        ifelse(grepl("blue", as.character(condition)), "bluejay",
               as.character(condition)))))
    
    # recode background and demographic variables
    d_clean <- d_clean_2 %>%
      mutate( # deal with study number
        study = factor(study)) %>%
      mutate( # deal with study duration
        duration = as.numeric(difftime(strptime(end_time, "%I:%M:%S"),
                                       strptime(start_time, "%I:%M:%S"),
                                       units = "mins"))) %>%
      mutate( # deal with race
        race_asian_east = 
          factor(ifelse(is.na(race_asian_east), "", "asian_east ")),
        race_asian_south = 
          factor(ifelse(is.na(race_asian_south), "", "asian_south ")),
        race_asian_other = 
          factor(ifelse(is.na(race_asian_other), "", "asian_other ")),
        race_black = 
          factor(ifelse(is.na(race_black), "", "black ")),
        race_hispanic = 
          factor(ifelse(is.na(race_hispanic), "", "hispanic ")),
        race_middle_eastern = 
          factor(ifelse(is.na(race_middle_eastern), "", "middle_eastern ")),
        race_native_american = 
          factor(ifelse(is.na(race_native_american), "", "native_american ")),
        race_pac_islander = 
          factor(ifelse(is.na(race_pac_islander), "", "pac_islander ")),
        race_white = 
          factor(ifelse(is.na(race_white), "", "white ")),
        race_other_prefno = 
          factor(ifelse(is.na(race_other_prefno), "", "other_prefno ")),
        race_cat = paste0(race_asian_east, race_asian_south, race_asian_other,
                          race_black, race_hispanic, race_middle_eastern,
                          race_native_american, race_pac_islander, race_white,
                          race_other_prefno),
        race_cat2 = factor(sub(" +$", "", race_cat)),
        race_cat3 = factor(ifelse(grepl(" ", race_cat2) == T, "multiracial",
                                  as.character(race_cat2)))) %>%
      select(study, subid:end_time, duration, finished:gender, 
             education:age_approx, race_cat3) %>%
      rename(race_cat = race_cat3)
    
    # filter conditions if desired
    if(is.element("none", chosenExclude)) {} else {
      d_clean <- d_clean %>%
        filter(!condition %in% chosenExclude)
    }
    
    # remove extraneous dfs and variables
    rm(d, d_clean_1, d_clean_2)
  }
  
  if(datasource == "study 1 moral") {
    
    # set target dataset
    d <- full_join(d_raw_study1_moral_robot, d_raw_study1_moral_beetle)

    # enact exclusionary criteria
    d_clean_1 <- d %>%
      mutate(finished_mod = ifelse(is.na(CATCH), 0,
                                   ifelse(finished == 1, 1,
                                          0.5))) %>%
      filter(CATCH == 64, # exclude Ps who fail catch trials 
             finished_mod != 0) # exclude Ps who did not complete task
      
    # recode background and demographic variables
    d_clean <- d_clean_1 %>%
      mutate( # deal with study number, condition
        study = factor(study),
        condition = factor(condition)) %>%
      mutate( # deal with study duration
        duration = as.numeric(difftime(strptime(end_time, "%I:%M:%S"),
                                       strptime(start_time, "%I:%M:%S"),
                                       units = "mins"))) %>%
      select(study, subid, date, start_time, end_time, duration, 
             finished_mod, mturkcode:feedback)

    # remove extraneous dfs and variables
    rm(d, d_clean_1)
  }
  
#   # transform to 0 to 6 scale
#   d_clean <- d_clean %>%
#     gather(mc, score, happy:pride) %>%
#     mutate(score = score + 3) %>% # transform from -3 to 3 --> 0 to 6
#     spread(mc, score)
  
  # return cleaned dataset
  return(d_clean)
}

# make function for examining exclusion of participants
excludedCounts <- function(datasource) {
  
  # set datasource
  if(datasource == "study 1"){
    d <- d1
    d_raw <- d_raw_study1
  }
  if(datasource == "study 1 moral"){
    d <- d1_moral
    d_raw <- full_join(d_raw_study1_moral_robot, d_raw_study1_moral_beetle)
  }
  if(datasource == "study 2"){
    d <- d2
    d_raw <- d_raw_study2
  }
  if(datasource == "study 3"){
    d <- d3
    d_raw <- d_raw_study3
  }
  if(datasource == "study 4"){
    d <- d4
    d_raw <- d_raw_study4
  }
  
  # get subids of successful participants
  d_subids <- levels(factor(as.character(d$subid)))
  
  # get subids of excluded participants
  d_excluded <- d_raw %>%
    filter(is.element(subid, d_subids) == FALSE) %>%
    select(condition, subid, finished, starts_with("CATCH"))

  # count excluded participants
  d_excluded_n <- length(d_excluded$subid)
  
  if(datasource %in% c("study 1", "study 2", "study 4", "study 1 moral")) {
    # count participants who did not finish
    d_excluded_unfinished <- d_excluded %>%
      filter(is.na(CATCH) == T,
             finished != 1) %>%
      select(subid) %>%
      c()
    
    # count participants who finished, but failed catch trial
    d_excluded_CATCH <- d_excluded %>%
      filter(is.element(subid, d_excluded_unfinished$subid) == FALSE) %>%
      filter(CATCH != 1) %>%
      select(subid) %>%
      c()
  }
  
  if(datasource == "study 3") {
    # count participants who did not finish
    d_excluded_unfinished <- d_excluded %>%
      filter(is.na(CATCH..characterL) == T,
             is.na(CATCH..characterR) == T,
             finished != 1) %>%
      select(subid) %>%
      c()
    
    # count participants who finished, but failed catch trial
    d_excluded_CATCH <- d_excluded %>%
      filter(is.element(subid, d_excluded_unfinished$subid) == FALSE) %>%
      filter(CATCH..characterL != 5 | CATCH..characterR != 5) %>%
      select(subid) %>%
      c()
  }
  
  if(datasource %in% c("study 1", "study 2", "study 3", "study 4")) {
    # count participants who finished and passed catch trial,
    # but did not provide year of birth
    d_excluded_no_yob <- d_excluded %>%
      filter(is.element(subid, d_excluded_unfinished$subid) == FALSE,
             is.element(subid, d_excluded_CATCH$subid) == FALSE) %>%
      mutate(yob = as.numeric(as.character(yob))) %>%
      filter(is.na(yob) | yob < 1899 | nchar(as.character(yob)) != 4) %>%
      select(subid) %>%
      c()
    
    # count participants who finished and passed catch trial, 
    # but did not provide year of birth
    d_excluded_young <- d_excluded %>%
      filter(is.element(subid, d_excluded_unfinished$subid) == FALSE,
             is.element(subid, d_excluded_CATCH$subid) == FALSE,
             is.element(subid, d_excluded_no_yob$subid) == FALSE) %>%
      mutate(yob = as.numeric(as.character(yob))) %>%
      filter(is.na(yob) | 2016 - yob < 18) %>%
      select(subid) %>%
      c()
    
    # sum up excluded participants by category
    total <- sum(length(d_excluded_unfinished$subid),
                 length(d_excluded_CATCH$subid),
                 length(d_excluded_no_yob$subid),
                 length(d_excluded_young$subid))
    
    # calculate counts
    excluded_counts <- 
      data.frame("did_not_finish" = length(d_excluded_unfinished$subid),
                 "failed_catch_trial" = length(d_excluded_CATCH$subid),
                 "did_not_provide_yob" = length(d_excluded_no_yob$subid),
                 "too_young" = length(d_excluded_young$subid),
                 "TOTAL_excluded" = total,
                 "TOTAL_participated" = length(d$subid),
                 "OVERALL_TOTAL" = sum(total, length(d$subid)))
    
    if(total != d_excluded_n) {
      stop("Error: 4 sources of exclusion do not add up to total.")
      } else {
        return(excluded_counts)
      }
  }
  
  if(datasource == "study 1 moral") {
    # sum up excluded participants by category
    total <- sum(length(d_excluded_unfinished$subid),
                 length(d_excluded_CATCH$subid))
    
    # calculate counts
    excluded_counts <- 
      data.frame("did_not_finish" = length(d_excluded_unfinished$subid),
                 "failed_catch_trial" = length(d_excluded_CATCH$subid),
                 "TOTAL_excluded" = total,
                 "TOTAL_participated" = length(d$subid),
                 "OVERALL_TOTAL" = sum(total, length(d$subid)))
    
    if(total != d_excluded_n) {
      stop("Error: 4 sources of exclusion do not add up to total.")
      } else {
        return(excluded_counts)
      }
  }

}


# make function for stripping dataframes for dimension reducation
makeDRDF <- function(datasource, chosenCondition) {
  
  # set target dataset
  if(datasource == "study 1"){d <- d1}
  if(datasource == "study 2"){d <- d2}
  if(datasource == "study 3"){
    # rename variables for ease of function applpication
    d <- d3 %>%
      rename(order = condition,
             condition = target)
    
    # rename subids by condition if collapses across conditions
    d <- d %>%
      mutate(subid = paste(condition, subid, sep = "_"))
  }
  if(datasource == "study 4"){d <- d4}
  
  # filter by condition if specified
  if(chosenCondition %in% c("beetle", "robot")) {
    d <- d %>% filter(condition == chosenCondition)
  }
  
  # make stripped dataframe for dimension reducation analyses
  d_strip <- d %>%
    select(subid, happy:pride)
  d_strip <- data.frame(d_strip[,-1], row.names = d_strip$subid)
  
  # return stripped dataframe
  return(d_strip)
}

# make demographics functions
demoSampleSize <- function(datasource) {

  # set target dataset
  if(datasource == "study 1"){d <- d1}
  if(datasource == "study 1 moral"){d <- d1_moral}
  if(datasource == "study 2"){d <- d2}
  if(datasource == "study 3"){
    # rename variables for ease of function applpication
    d <- d3 %>%
      rename(order = condition,
             condition = target)
  }
  if(datasource == "study 4"){d <- d4}

  # get sample size per condition
  sample_size <- vector()
  for(i in levels(d$condition)) {
    sample_size[as.character(i)] <- 
      as.numeric(d %>% filter(condition == i) %>% select(subid) %>% 
                   unique() %>% count())
  }

  # add total sample size  
  sample_size["all"] <- as.numeric(d %>% select(subid) %>% 
                                     unique() %>% count())
  
  # make into dataframe for using kable
  sample_size <- data.frame(sample_size) %>%
    add_rownames() %>%
    rename(condition = rowname,
           n = sample_size)
  
  # return dataframe for using kable
  return(sample_size)
}
demoDuration <- function(datasource) {

  # set target dataset
  if(datasource == "study 1"){d <- d1}
  if(datasource == "study 1 moral"){d <- d1_moral}
  if(datasource == "study 2"){d <- d2}
  if(datasource == "study 3"){
    # recode variables for ease of function applpication
    d <- d3 %>%
      mutate(condition = "within-subjects")
  }
  if(datasource == "study 4"){d <- d4}

  # get sample size per condition
  duration <- d %>%
    group_by(condition) %>%
    summarise(min_duration = min(duration),
              max_duration = max(duration),
              median_duration = median(duration),
              mean_duration = mean(duration),
              sd_duration = sd(duration))

  # add total duration
  if(datasource %in% c("study 1", "study 2", "study 4")) {
    all <- d %>%
      summarise(min_duration = min(duration),
                max_duration = max(duration),
                median_duration = median(duration),
                mean_duration = mean(duration),
                sd_duration = sd(duration)) %>%
      mutate(condition = "all")
    duration <- rbind(duration, all) # not sure why full_join doesn't work    
  }

  # return dataframe for using kable
  return(duration)
}
demoAge <- function(datasource) {

  # set target dataset
  if(datasource == "study 1"){d <- d1}
  if(datasource == "study 1 moral"){d <- d1_moral}
  if(datasource == "study 2"){d <- d2}
  if(datasource == "study 3"){
    # recode variables for ease of function applpication
    d <- d3 %>%
      mutate(condition = "within-subjects")
  }
  if(datasource == "study 4"){d <- d4}

  # get sample size per condition
  age <- d %>%
    group_by(condition) %>%
    summarise(min_age = min(age_approx),
              max_age = max(age_approx),
              median_age = median(age_approx),
              mean_age = mean(age_approx),
              sd_age = sd(age_approx))

  # add total age
  if(datasource %in% c("study 1", "study 2", "study 4")) {
    all <- d %>%
      summarise(min_age = min(age_approx),
                max_age = max(age_approx),
                median_age = median(age_approx),
                mean_age = mean(age_approx),
                sd_age = sd(age_approx)) %>%
      mutate(condition = "all")
    age <- full_join(age, all)
  }

  # return dataframe for using kable
  return(age)
}
demoGender <- function(datasource) {

  # set target dataset
  if(datasource == "study 1"){d <- d1}
  if(datasource == "study 1 moral"){d <- d1_moral}
  if(datasource == "study 2"){d <- d2}
  if(datasource == "study 3"){d <- d3}
  if(datasource == "study 4"){d <- d4}

  # get gender per condition and overall
  if(datasource %in% c("study 1", "study 2", "study 4")) {
    gender <- data.frame(addmargins(with(d, table(condition, gender)))) %>%
      filter(gender != "Sum") %>%
      rename(n = Freq)
  }
  
  if(datasource == "study 3") {
    gender <- data.frame(with(d, table(gender))) %>%
      rename(n = Freq) %>%
      mutate(condition = "Sum") %>%
      select(condition, gender, n)
  }
  
  if(datasource %in% c("study 1", "study 2", "study 3")) {
    gender <- gender %>%
    mutate(condition = factor(ifelse(condition == "Sum", 
                                     "all", as.character(condition)),
                              levels = c("beetle", "robot", "all"))) %>%
    arrange(condition, gender) %>%
    spread(gender, n)
  }
  
  if(datasource == "study 4") {
    gender <- gender %>%
    mutate(condition = factor(ifelse(condition == "Sum", 
                                     "all", as.character(condition)),
                              levels = c(levels(d$condition), "all"))) %>%
    arrange(condition, gender) %>%
    spread(gender, n)
  }
  
  # return dataframe for using kable
  return(gender)
}
demoRace <- function(datasource) {

  # set target dataset
  if(datasource == "study 1"){d <- d1}
  if(datasource == "study 1 moral"){d <- d1_moral}
  if(datasource == "study 2"){d <- d2}
  if(datasource == "study 3"){d <- d3}
  if(datasource == "study 4"){d <- d4}

  # get race per condition and overall
  if(datasource %in% c("study 1", "study 2", "study 4")) {
    race <- data.frame(addmargins(with(d, table(condition, race_cat)))) %>%
      filter(race_cat != "Sum") %>%
      rename(n = Freq)
  }
  
  if(datasource == "study 3") {
    race <- data.frame(with(d, table(race_cat))) %>%
      rename(n = Freq) %>%
      mutate(condition = "Sum") %>%
      select(condition, race_cat, n)
  }
  
  if(datasource %in% c("study 1", "study 2", "study 3")) {
    race <- race %>%
    mutate(condition = factor(ifelse(condition == "Sum", 
                                     "all", as.character(condition)),
                              levels = c("beetle", "robot", "all"))) %>%
    arrange(condition, race_cat) %>%
    spread(race_cat, n)
  }
  
  if(datasource == "study 4") {
    race <- race %>%
    mutate(condition = factor(ifelse(condition == "Sum", 
                                     "all", as.character(condition)),
                              levels = c(levels(d$condition), "all"))) %>%
    arrange(condition, race_cat) %>%
    spread(race_cat, n)
  }
  
  # return dataframe for using kable
  return(race)
}
demoReligion <- function(datasource) {

  # set target dataset
  if(datasource == "study 1"){d <- d1}
  if(datasource == "study 1 moral"){d <- d1_moral}
  if(datasource == "study 2"){d <- d2}
  if(datasource == "study 3"){d <- d3}

  # get religion per condition and overall
  if(datasource %in% c("study 1", "study 2")) {
    religion <- data.frame(addmargins(with(d, table(condition, religion_cat)))) %>%
      filter(religion_cat != "Sum") %>%
      rename(n = Freq)
  }
  
  if(datasource == "study 3") {
    religion <- data.frame(with(d, table(religion_cat))) %>%
      rename(n = Freq) %>%
      mutate(condition = "Sum") %>%
      select(condition, religion_cat, n)
  }
  
  if(datasource %in% c("study 1", "study 2", "study 3")) {
    religion <- religion %>%
    mutate(condition = factor(ifelse(condition == "Sum", 
                                     "all", as.character(condition)),
                              levels = c("beetle", "robot", "all"))) %>%
    arrange(condition, religion_cat) %>%
    spread(religion_cat, n)
  }
  
  # return dataframe for using kable
  if(datasource == "study 4"){
    stop("Religion information not available for Study 4")
  } else {return(religion)}
}
demoEducation <- function(datasource) {

  # set target dataset
  if(datasource == "study 4"){d <- d4}
  
  # get education per condition and overall
  if(datasource == "study 4") {
    education <- 
      data.frame(addmargins(with(d, table(condition, education)))) %>%
      filter(education != "Sum") %>%
      rename(n = Freq) %>%
      mutate(condition = factor(ifelse(condition == "Sum",
                                       "all", as.character(condition)),
                                levels = c(levels(d$condition), "all")),
             education = factor(education,
                                levels = c(1:7, 0),
                                labels = c("some_HS",
                                           "HS_diploma",
                                           "some_college",
                                           "associates",
                                           "bachelors",
                                           "some_grad",
                                           "grad",
                                           "pref_no"))) %>%
      arrange(condition, education) %>%
      spread(education, n)
  }
  
  # return dataframe for using kable
  if(datasource %in% c("study 1", "study 2", "study 3")){
    stop("Education information not available for Studies 1-3")
  } else {return(education)}
}

# set 21-color palette (thank to Paul Tol: https://personal.sron.nl/~pault/colourschemes.pdf)
tol21rainbow = c("#771155", "#AA4488", "#CC99BB", "#114477", "#4477AA", "#77AADD", "#117777", "#44AAAA", "#77CCCC", "#117744", "#44AA77", "#88CCAA", "#777711", "#AAAA44", "#DDDD77", "#774411", "#AA7744", "#DDAA77", "#771122", "#AA4455", "#DD7788")
```

```{r modeling decisions, echo = F}
# remove outliers?
chosenOutlierHandling <- "keep"
# chosenOutlierHandling <- "remove"

# exclude any conditions in study 4?
chosenExclude <- "none"
# chosenExclude <- c("stapler", "car", "computer")

# exclude any items?
chosenExcludeItem <- "none"
# chosenExcludeItem <- "computations"

# for current purposes always choose minimal residual (fm = "minres") instead of ML because of non-normality

# for EFAs, what kind of correlation?
chosenCorType <- "cor" # pearson correlation, less appropriate for ordinal data but 7-point likert scale might be ok
# chosenCorType <- "poly" # polychoric correlation, appropriate for ordinal data but seems to throw errors

kable(data.frame("conditionsExcluded" = chosenExclude,
                 "outlierHandling" = chosenOutlierHandling, 
                 "EFA_correlation" = chosenCorType))
```

<p style="text-align:right"><a href="#header">back to TOC</a></p>

# Data preparation

```{r data upload, message = F, echo = F}
# study 1 (2015-12-15, 2 conditions, between-subjects)
d_raw_study1 <- read.csv("/Users/kweisman/Documents/Research (Stanford)/Projects/GGW-mod/ggw-mod2/mturk/v1 (2 conditions between)/GGWmod2_v1_clean.csv") %>%
  mutate(study = "study 1")

# study 1 moral fu ROBOT (2015-02-26)
d_raw_study1_moral_robot <- read.csv("/Users/kweisman/Documents/Research (Stanford)/Projects/GGW-mod/ggw-mod2_moral/mturk/v1 follow up 1 (robot)/GGWmod2moralv1_clean.csv") %>%
  mutate(study = "study 1 moral")

# study 1 moral fu BEETLE (2015-03-01)
d_raw_study1_moral_beetle <- read.csv("/Users/kweisman/Documents/Research (Stanford)/Projects/GGW-mod/ggw-mod2_moral/mturk/v1 follow up 2 (beetle)/GGWmod2moralv1bug_clean.csv") %>%
  mutate(study = "study 1 moral")

# study 2 (2016-01-12, 2 conditions, between-subjects - REPLICATION)
d_raw_study2 <- read.csv("/Users/kweisman/Documents/Research (Stanford)/Projects/GGW-mod/ggw-mod2/mturk/v1 (replication)/GGWmod2_v1_replication_clean.csv") %>%
  mutate(study = "study 2")

# study 3 (2016-01-10, 2 conditions, within-subjects)
d_raw_study3 <- read.csv("/Users/kweisman/Documents/Research (Stanford)/Projects/GGW-mod/ggw-mod2/mturk/v2 (2 conditions within)/GGWmod2_v2_withinsubjects_clean.csv") %>%
  mutate(study = "study 3")

# study 4 (2016-01-14, 21 conditions, between-subjects)
d_raw_study4 <- read.csv("/Users/kweisman/Documents/Research (Stanford)/Projects/GGW-mod/ggw-mod2/mturk/v3 (21 conditions between)/GGWmod2_v3_many_characters_clean.csv") %>%
  mutate(study = "study 4")
```

```{r data cleanup, message = F, echo = F}
# get original (study 1) worker IDs
d1_workers <- read.csv("/Users/kweisman/Documents/Research (Stanford)/Projects/GGW-mod/ggw-mod2/mturk/v1 (2 conditions between)/Batch_2202606_batch_results.csv") %>%
  select(WorkerId, Answer.surveycode) %>%
  rename(workerID = WorkerId) %>%
  mutate(mturkcode = as.numeric(gsub("kara", "", Answer.surveycode))) %>%
  select(-Answer.surveycode)

# get moral robot worker IDs
d1_moral_robot_workers <- read.csv("/Users/kweisman/Documents/Research (Stanford)/Projects/GGW-mod/ggw-mod2_moral/mturk/v1 follow up 1 (robot)/Batch_2285768_batch_results.csv") %>%
  full_join(read.csv("/Users/kweisman/Documents/Research (Stanford)/Projects/GGW-mod/ggw-mod2_moral/mturk/v1 follow up 1 (robot)/Batch_2292738_batch_results.csv")) %>%
  select(WorkerId, Answer.surveycode) %>%
  rename(workerID = WorkerId) %>%
  mutate(condition = substr(Answer.surveycode, 1, 5),
         mturkcode = as.numeric(gsub("robot", "", Answer.surveycode))) %>%
  select(-Answer.surveycode)

# get moral beetle worker IDs
d1_moral_beetle_workers <- read.csv("/Users/kweisman/Documents/Research (Stanford)/Projects/GGW-mod/ggw-mod2_moral/mturk/v1 follow up 2 (beetle)/Batch_2291434_batch_results.csv") %>%
  full_join(read.csv("/Users/kweisman/Documents/Research (Stanford)/Projects/GGW-mod/ggw-mod2_moral/mturk/v1 follow up 2 (beetle)/Batch_2291712_batch_results.csv")) %>%
  select(WorkerId, Answer.surveycode) %>%
  rename(workerID = WorkerId) %>%
  mutate(condition = substr(Answer.surveycode, 1, 6),
         mturkcode = as.numeric(gsub("beetle", "", Answer.surveycode))) %>%
  select(-Answer.surveycode)

d1_moral_workers <- full_join(d1_moral_robot_workers, d1_moral_beetle_workers)

# clean up datasets
d1 <- cleanup("study 1")
d1_moral <- cleanup("study 1 moral")

# clean up datasets
d1_d_moral_merged <- left_join(d1, d1_workers)
d1_moral_d_moral_merged <- full_join(d1_moral, d1_moral_workers)

# merge
d1_moral_merged <- left_join(d1_moral_d_moral_merged, d1_d_moral_merged, by = "workerID") %>%
  select(study.x:workerID, happy:religion_cat) %>%
  rename(study = study.x,
         subid = subid.x,
         date = date.x,
         start_time = start_time.x,
         end_time = end_time.x,
         duration = duration.x,
         finished_mod = finished_mod.x,
         mturkcode = mturkcode.x,
         condition = condition.x,
         CATCH = CATCH.x,
         feedback = feedback.x) %>%
  select(-CATCH.y, -feedback.y, -finished_mod.y)

rm(d1_d_moral_merged, d1_moral_d_moral_merged)
```

```{r dataframes for dimension reducation, message = F, echo = F}
# make dataframes for s1
d1_beetle <- makeDRDF("study 1", "beetle")
d1_robot <- makeDRDF("study 1", "robot")
d1_all <- makeDRDF("study 1", "all")
```

<p style="text-align:right"><a href="#header">back to TOC</a></p>

# Study 1 (2015-12-15, 2 conditions, between-subjects)

## Demographics

```{r s1 demographics, echo = F}
# # examine exclusion
# kable(excludedCounts("study 1"), align = "l",
#       caption = "Study 1: Exclusion")

# make demographics tables
kable(demoSampleSize("study 1"), align = "l", digits = 2,
      caption = "Study 1: Sample size")
kable(demoDuration("study 1"), align = "l", digits = 2,
      caption = "Study 1: Study duration (minutes)")
kable(demoAge("study 1"), align = "l", digits = 2,
      caption = "Study 1: Participant age (years; approximate)")
kable(demoGender("study 1"), align = "l", digits = 2,
      caption = "Study 1: Participant gender")
kable(demoRace("study 1"), align = "l", digits = 2,
      caption = "Study 1: Participant race/ethnicity")
kable(demoReligion("study 1"), align = "l", digits = 2,
      caption = "Study 1: Participant religion")
```

<p style="text-align:right"><a href="#header">back to TOC</a></p>

## Exploratory factor analysis

### Run EFA with varimax rotation

```{r s1 all varimax rotation, echo = F}
# run EFA with rotation with N factors
efa_d1_all_rotatedN <- fa(d1_all, 3, rotate = "varimax", 
                          scores = "regression", # need to be clear about choice!
                          cor = chosenCorType, fm = "minres")
print(efa_d1_all_rotatedN)

# get loadings for each factor
efa_d1_all_rotatedN_loadings <- loadings(efa_d1_all_rotatedN)[] %>%
  data.frame() %>% 
  add_rownames(var = "mc")

# add factor scores for each participant
d1_factor_scores <- efa_d1_all_rotatedN$scores %>%
  data.frame() %>%
  add_rownames(var = "subid") %>%
  full_join(d1 %>% select(subid, mturkcode)) %>%
  full_join(d1_workers) %>%
  select(-subid, -mturkcode)

d1_moral_merged <- d1_moral_merged %>%
  left_join(d1_factor_scores)
```

<p style="text-align:right"><a href="#header">back to TOC</a></p>

# Study 1 Moral Follow-up (robot: 2016-02-26; beetle: 2016-03-01)

## Data preparation

```{r dataframe for moral analysis, message = F, echo = F}
# make dataset
d_moral_merged <- d1_moral_merged %>%
  filter(is.na(subid) == F) %>%
  mutate(condition = factor(condition),
         religion_cat2 = factor(
           ifelse(religion_cat %in% c("christianity", "judaism"), "judeo-christian",
                  ifelse(religion_cat == "none", "not religious",
                         "other (religious)"))),
         race_cat2 = factor(ifelse(race_cat == "white", "white", "non-white")),
#          scaled_concern_general = scale(concern_general),
#          scaled_concern_phy_crush = scale(concern_phy_crush),
#          scaled_concern_phy_burn = scale(concern_phy_burn),
#          scaled_concern_phy_crash = scale(concern_phy_crash),
#          scaled_concern_soc_insult = scale(concern_soc_insult),
#          scaled_concern_soc_ignore = scale(concern_soc_ignore),
#          scaled_concern_soc_photo = scale(concern_soc_photo),
#          scaled_concern_per_dark = scale(concern_per_dark),
#          scaled_concern_per_loud = scale(concern_per_loud),
#          scaled_concern_per_memory = scale(concern_per_memory),
#          scaled_concern_oth_off = scale(concern_oth_off),
#          scaled_concern_oth_alone = scale(concern_oth_alone),
#          scaled_MR1 = scale(MR1),
#          scaled_MR2 = scale(MR2),
#          scaled_MR3 = scale(MR3),
         median_MR1 = ifelse(MR1 < median(MR1), "low", "high"),
         median_MR2 = ifelse(MR2 < median(MR2), "low", "high"),
         median_MR3 = ifelse(MR3 < median(MR3), "low", "high"),
         mean_MR1 = ifelse(MR1 < mean(MR1), "low", "high"),
         mean_MR2 = ifelse(MR2 < mean(MR2), "low", "high"),
         mean_MR3 = ifelse(MR3 < mean(MR3), "low", "high"))

d_moral_merged_n <- length(levels(factor(d_moral_merged$subid)))
```

## Demographics

```{r s1m demographics, echo = F}
# examine exclusion
# kable(excludedCounts("study 1 moral"), align = "l",
#       caption = "Study 1: Exclusion")

# make demographics tables
kable(demoSampleSize("study 1 moral"), align = "l", digits = 2,
      caption = "Study 1: Sample size")
kable(demoDuration("study 1 moral"), align = "l", digits = 2,
      caption = "Study 1: Study duration (minutes)")
# kable(demoAge("study 1 moral"), align = "l", digits = 2,
#       caption = "Study 1: Participant age (years; approximate)")
# kable(demoGender("study 1 moral"), align = "l", digits = 2,
#       caption = "Study 1: Participant gender")
# kable(demoRace("study 1 moral"), align = "l", digits = 2,
#       caption = "Study 1: Participant race/ethnicity")
# kable(demoReligion("study 1 moral"), align = "l", digits = 2,
#       caption = "Study 1: Participant religion")
```

<p style="text-align:right"><a href="#header">back to TOC</a></p>

## Correlations with general moral concern

```{r correlations general, message = F, echo = F}
# pearson correlations with raw general concern
# cor_table <- cor(d_moral_merged %>% select(MR1, MR2, MR3, concern_general))
# cor_table[upper.tri(cor_table)] <- NA
# round(cor_table, 3)

# ALL participants
rp_MR1.gen <- with(d_moral_merged, cor.test(MR1, concern_general, # physiological
                                 method = "pearson")); rp_MR1.gen 
rp_MR2.gen <- with(d_moral_merged, cor.test(MR2, concern_general, # social-emotional
                                 method = "pearson")); rp_MR2.gen
rp_MR3.gen <- with(d_moral_merged, cor.test(MR3, concern_general, # perceptual-cognitive
                                 method = "pearson")); rp_MR3.gen
rp_MR1.MR2 <- with(d_moral_merged, cor.test(MR1, MR2, method = "pearson")); rp_MR1.MR2
rp_MR1.MR3 <- with(d_moral_merged, cor.test(MR1, MR3, method = "pearson")); rp_MR1.MR3
rp_MR2.MR3 <- with(d_moral_merged, cor.test(MR2, MR3, method = "pearson")); rp_MR2.MR3

# compare phy to soc-emo
paired.r(xy = rp_MR1.gen$estimate,
         xz = rp_MR2.gen$estimate,
         yz = rp_MR1.MR2$estimate,
         n = d_moral_merged_n)

# compare phy to per-cog
paired.r(xy = rp_MR1.gen$estimate,
         xz = rp_MR3.gen$estimate,
         yz = rp_MR1.MR3$estimate,
         n = d_moral_merged_n)

# compare soc-emo to per-cog
paired.r(xy = rp_MR2.gen$estimate,
         xz = rp_MR3.gen$estimate,
         yz = rp_MR2.MR3$estimate,
         n = d_moral_merged_n)

# spearman correlations with rankings of general concern
rs_MR1.genrank <- with(d_moral_merged, cor.test(MR1, concern_general, # physiological
                                 method = "spearman")); rs_MR1.genrank 
rs_MR2.genrank <- with(d_moral_merged, cor.test(MR2, concern_general, # social-emotional
                                 method = "spearman")); rs_MR2.genrank
rs_MR3.genrank <- with(d_moral_merged, cor.test(MR3, concern_general, # perceptual-cognitive
                                 method = "spearman")); rs_MR3.genrank
rs_MR1.MR2 <- with(d_moral_merged, cor.test(MR1, MR2, method = "spearman")); rs_MR1.MR2
rs_MR1.MR3 <- with(d_moral_merged, cor.test(MR1, MR3, method = "spearman")); rs_MR1.MR3
rs_MR2.MR3 <- with(d_moral_merged, cor.test(MR2, MR3, method = "spearman")); rs_MR2.MR3

# compare phy to soc-emo
paired.r(xy = rs_MR1.genrank$estimate,
         xz = rs_MR2.genrank$estimate,
         yz = rs_MR1.MR2$estimate,
         n = d_moral_merged_n)

# compare phy to per-cog
paired.r(xy = rs_MR1.genrank$estimate,
         xz = rs_MR3.genrank$estimate,
         yz = rs_MR1.MR3$estimate,
         n = d_moral_merged_n)

# compare soc-emo to per-cog
paired.r(xy = rs_MR2.genrank$estimate,
         xz = rs_MR3.genrank$estimate,
         yz = rs_MR2.MR3$estimate,
         n = d_moral_merged_n)

# ROBOT participants
rp_ROBOT_MR1.gen <- with(subset(d_moral_merged, condition == "robot"),
                         cor.test(MR1, concern_general, # physiological
                                  method = "pearson")); rp_ROBOT_MR1.gen 
rp_ROBOT_MR2.gen <- with(subset(d_moral_merged, condition == "robot"), 
                         cor.test(MR2, concern_general, # social-emotional
                                  method = "pearson")); rp_ROBOT_MR2.gen
rp_ROBOT_MR3.gen <- with(subset(d_moral_merged, condition == "robot"), 
                         cor.test(MR3, concern_general, # perceptual-cognitive
                                  method = "pearson")); rp_ROBOT_MR3.gen
rp_ROBOT_MR1.MR2 <- with(subset(d_moral_merged, condition == "robot"), 
                         cor.test(MR1, MR2, method = "pearson")); rp_ROBOT_MR1.MR2
rp_ROBOT_MR1.MR3 <- with(subset(d_moral_merged, condition == "robot"), 
                         cor.test(MR1, MR3, method = "pearson")); rp_ROBOT_MR1.MR3
rp_ROBOT_MR2.MR3 <- with(subset(d_moral_merged, condition == "robot"), 
                         cor.test(MR2, MR3, method = "pearson")); rp_ROBOT_MR2.MR3

# compare phy to soc-emo
paired.r(xy = rp_ROBOT_MR1.gen$estimate,
         xz = rp_ROBOT_MR2.gen$estimate,
         yz = rp_ROBOT_MR1.MR2$estimate,
         n = d_moral_merged_n)

# compare phy to per-cog
paired.r(xy = rp_ROBOT_MR1.gen$estimate,
         xz = rp_ROBOT_MR3.gen$estimate,
         yz = rp_ROBOT_MR1.MR3$estimate,
         n = d_moral_merged_n)

# compare soc-emo to per-cog
paired.r(xy = rp_ROBOT_MR2.gen$estimate,
         xz = rp_ROBOT_MR3.gen$estimate,
         yz = rp_ROBOT_MR2.MR3$estimate,
         n = d_moral_merged_n)

# spearman correlations with rankings of general concern
rs_ROBOT_MR1.genrank <- with(subset(d_moral_merged, condition == "robot"),
                             cor.test(MR1, concern_general, # physiological
                                      method = "spearman")); rs_ROBOT_MR1.genrank 
rs_ROBOT_MR2.genrank <- with(subset(d_moral_merged, condition == "robot"),
                             cor.test(MR2, concern_general, # social-emotional
                                      method = "spearman")); rs_ROBOT_MR2.genrank
rs_ROBOT_MR3.genrank <- with(subset(d_moral_merged, condition == "robot"),
                             cor.test(MR3, concern_general, # perceptual-cognitive
                                      method = "spearman")); rs_ROBOT_MR3.genrank
rs_ROBOT_MR1.MR2 <- with(subset(d_moral_merged, condition == "robot"),
                         cor.test(MR1, MR2, method = "spearman")); rs_ROBOT_MR1.MR2
rs_ROBOT_MR1.MR3 <- with(subset(d_moral_merged, condition == "robot"),
                         cor.test(MR1, MR3, method = "spearman")); rs_ROBOT_MR1.MR3
rs_ROBOT_MR2.MR3 <- with(subset(d_moral_merged, condition == "robot"),
                         cor.test(MR2, MR3, method = "spearman")); rs_ROBOT_MR2.MR3

# compare phy to soc-emo
paired.r(xy = rs_ROBOT_MR1.genrank$estimate,
         xz = rs_ROBOT_MR2.genrank$estimate,
         yz = rs_ROBOT_MR1.MR2$estimate,
         n = d_moral_merged_n)

# compare phy to per-cog
paired.r(xy = rs_ROBOT_MR1.genrank$estimate,
         xz = rs_ROBOT_MR3.genrank$estimate,
         yz = rs_ROBOT_MR1.MR3$estimate,
         n = d_moral_merged_n)

# compare soc-emo to per-cog
paired.r(xy = rs_ROBOT_MR2.genrank$estimate,
         xz = rs_ROBOT_MR3.genrank$estimate,
         yz = rs_ROBOT_MR2.MR3$estimate,
         n = d_moral_merged_n)

# BEETLE participants
rp_BEETLE_MR1.gen <- with(subset(d_moral_merged, condition == "beetle"),
                         cor.test(MR1, concern_general, # physiological
                                  method = "pearson")); rp_BEETLE_MR1.gen 
rp_BEETLE_MR2.gen <- with(subset(d_moral_merged, condition == "beetle"), 
                         cor.test(MR2, concern_general, # social-emotional
                                  method = "pearson")); rp_BEETLE_MR2.gen
rp_BEETLE_MR3.gen <- with(subset(d_moral_merged, condition == "beetle"), 
                         cor.test(MR3, concern_general, # perceptual-cognitive
                                  method = "pearson")); rp_BEETLE_MR3.gen
rp_BEETLE_MR1.MR2 <- with(subset(d_moral_merged, condition == "beetle"), 
                         cor.test(MR1, MR2, method = "pearson")); rp_BEETLE_MR1.MR2
rp_BEETLE_MR1.MR3 <- with(subset(d_moral_merged, condition == "beetle"), 
                         cor.test(MR1, MR3, method = "pearson")); rp_BEETLE_MR1.MR3
rp_BEETLE_MR2.MR3 <- with(subset(d_moral_merged, condition == "beetle"), 
                         cor.test(MR2, MR3, method = "pearson")); rp_BEETLE_MR2.MR3

# compare phy to soc-emo
paired.r(xy = rp_BEETLE_MR1.gen$estimate,
         xz = rp_BEETLE_MR2.gen$estimate,
         yz = rp_BEETLE_MR1.MR2$estimate,
         n = d_moral_merged_n)

# compare phy to per-cog
paired.r(xy = rp_BEETLE_MR1.gen$estimate,
         xz = rp_BEETLE_MR3.gen$estimate,
         yz = rp_BEETLE_MR1.MR3$estimate,
         n = d_moral_merged_n)

# compare soc-emo to per-cog
paired.r(xy = rp_BEETLE_MR2.gen$estimate,
         xz = rp_BEETLE_MR3.gen$estimate,
         yz = rp_BEETLE_MR2.MR3$estimate,
         n = d_moral_merged_n)

# spearman correlations with rankings of general concern
rs_BEETLE_MR1.genrank <- with(subset(d_moral_merged, condition == "beetle"),
                             cor.test(MR1, concern_general, # physiological
                                      method = "spearman")); rs_BEETLE_MR1.genrank 
rs_BEETLE_MR2.genrank <- with(subset(d_moral_merged, condition == "beetle"),
                             cor.test(MR2, concern_general, # social-emotional
                                      method = "spearman")); rs_BEETLE_MR2.genrank
rs_BEETLE_MR3.genrank <- with(subset(d_moral_merged, condition == "beetle"),
                             cor.test(MR3, concern_general, # perceptual-cognitive
                                      method = "spearman")); rs_BEETLE_MR3.genrank
rs_BEETLE_MR1.MR2 <- with(subset(d_moral_merged, condition == "beetle"),
                         cor.test(MR1, MR2, method = "spearman")); rs_BEETLE_MR1.MR2
rs_BEETLE_MR1.MR3 <- with(subset(d_moral_merged, condition == "beetle"),
                         cor.test(MR1, MR3, method = "spearman")); rs_BEETLE_MR1.MR3
rs_BEETLE_MR2.MR3 <- with(subset(d_moral_merged, condition == "beetle"),
                         cor.test(MR2, MR3, method = "spearman")); rs_BEETLE_MR2.MR3

# compare phy to soc-emo
paired.r(xy = rs_BEETLE_MR1.genrank$estimate,
         xz = rs_BEETLE_MR2.genrank$estimate,
         yz = rs_BEETLE_MR1.MR2$estimate,
         n = d_moral_merged_n)

# compare phy to per-cog
paired.r(xy = rs_BEETLE_MR1.genrank$estimate,
         xz = rs_BEETLE_MR3.genrank$estimate,
         yz = rs_BEETLE_MR1.MR3$estimate,
         n = d_moral_merged_n)

# compare soc-emo to per-cog
paired.r(xy = rs_BEETLE_MR2.genrank$estimate,
         xz = rs_BEETLE_MR3.genrank$estimate,
         yz = rs_BEETLE_MR2.MR3$estimate,
         n = d_moral_merged_n)
```

## Exploratory plots 

```{r plots exploratory, message = F, echo = F, fig.width = 16, fig.height = 13}
# condition
ggplot(aes(x = condition, y = concern_general, 
           fill = condition, group = condition), data = d_moral_merged) +
  geom_boxplot(fill = "white", alpha = 0.5, width = 0.9) +
  geom_jitter(shape = 21, colour = "black", width = 0.7,
             alpha = 0.5, size = 3, stroke = 1) +
  theme_bw() +
  theme(text = element_text(size = 20)) +
  labs(title = "General Moral Concern by Condition (RAW SCORES)\n",
       x = "\nCondition",
       y = "General moral concern\n")

# # gender
# ggplot(aes(x = gender, y = concern_general, 
#            fill = gender, group = gender), data = d_moral_merged) +
#   geom_boxplot(fill = "white", alpha = 0.5, width = 0.9) +
#   geom_jitter(shape = 21, colour = "black", width = 0.7,
#              alpha = 0.5, size = 3, stroke = 1) +
#   theme_bw() +
#   theme(text = element_text(size = 20)) +
#   labs(title = "General Moral Concern by Gender (RAW SCORES)\n",
#        x = "\nGender",
#        y = "General moral concern\n")

# # age
# ggplot(aes(x = age_approx, y = concern_general, 
#            fill = condition, group = condition), data = d_moral_merged) +
#   geom_smooth(method = "lm", alpha = 0.1, aes(colour = condition)) +
#   geom_point(shape = 21, colour = "black",
#              alpha = 0.5, size = 3, stroke = 1) +
#   theme_bw() +
#   theme(text = element_text(size = 20)) +
#   labs(title = "General Moral Concern by Approximate Age (RAW SCORES)\n",
#        x = "\nApproximate age (years)",
#        y = "General moral concern\n")

# race_cat2
ggplot(aes(x = race_cat2, y = concern_general, 
           fill = race_cat2, group = race_cat2), data = d_moral_merged) +
  geom_boxplot(fill = "white", alpha = 0.5, width = 0.9) +
  geom_jitter(shape = 21, colour = "black", width = 0.7,
             alpha = 0.5, size = 3, stroke = 1) +
  theme_bw() +
  theme(text = element_text(size = 20)) +
  labs(title = "General Moral Concern by Race (RAW SCORES)\n",
       x = "\nRace",
       y = "General moral concern\n")

# # race_cat
# ggplot(aes(x = race_cat, y = concern_general, 
#            fill = race_cat, group = race_cat), data = d_moral_merged) +
#   geom_boxplot(fill = "white", alpha = 0.5, width = 0.9) +
#   geom_jitter(shape = 21, colour = "black", width = 0.7,
#              alpha = 0.5, size = 3, stroke = 1) +
#   theme_bw() +
#   theme(text = element_text(size = 20)) +
#   labs(title = "General Moral Concern by Race (RAW SCORES)\n",
#        x = "\nRace",
#        y = "General moral concern\n")

# religion_cat2
ggplot(aes(x = religion_cat2, y = concern_general, 
           fill = religion_cat2, group = religion_cat2), data = d_moral_merged) +
  geom_boxplot(fill = "white", alpha = 0.5, width = 0.9) +
  geom_jitter(shape = 21, colour = "black", width = 0.7,
             alpha = 0.5, size = 3, stroke = 1) +
  theme_bw() +
  theme(text = element_text(size = 20)) +
  labs(title = "General Moral Concern by Religion (RAW SCORES)\n",
       x = "\nReligion",
       y = "General moral concern\n")

# # religion_cat
# ggplot(aes(x = religion_cat, y = concern_general, 
#            fill = religion_cat, group = religion_cat), data = d_moral_merged) +
#   geom_boxplot(fill = "white", alpha = 0.5, width = 0.9) +
#   geom_jitter(shape = 21, colour = "black", width = 0.7,
#              alpha = 0.5, size = 3, stroke = 1) +
#   theme_bw() +
#   theme(text = element_text(size = 20)) +
#   labs(title = "General Moral Concern by Religion (RAW SCORES)\n",
#        x = "\nReligion",
#        y = "General moral concern\n")

# condition * race
ggplot(aes(x = interaction(condition, race_cat2), y = concern_general, 
           fill = condition, group = interaction(condition, race_cat2)), 
       data = d_moral_merged) +
  geom_boxplot(fill = "white", alpha = 0.5, width = 0.9) +
  geom_jitter(shape = 21, colour = "black", width = 0.7,
             alpha = 0.5, size = 3, stroke = 1) +
  theme_bw() +
  theme(text = element_text(size = 20)) +
  labs(title = "General Moral Concern by Condition and Race (RAW SCORES)\n",
       x = "\nRace",
       y = "General moral concern\n")

# condition * religion
ggplot(aes(x = interaction(condition, religion_cat2), y = concern_general, 
           fill = condition, group = interaction(condition, religion_cat2)), 
       data = d_moral_merged) +
  geom_boxplot(fill = "white", alpha = 0.5, width = 0.9) +
  geom_jitter(shape = 21, colour = "black", width = 0.7,
             alpha = 0.5, size = 3, stroke = 1) +
  theme_bw() +
  theme(text = element_text(size = 20)) +
  labs(title = "General Moral Concern by Condition and Religion (RAW SCORES)\n",
       x = "\nCondition",
       y = "General moral concern\n")
```

## Plots with general moral concern

```{r plots general raw, message = F, echo = F, fig.width = 16, fig.height = 13}
# raw scores
ggplot(aes(x = MR1, y = concern_general, fill = condition), data = d_moral_merged) +
  geom_smooth(method = "lm", alpha = 0.1, aes(colour = condition)) +
  geom_point(shape = 21, colour = "black", 
             alpha = 0.5, size = 3, stroke = 1) +
  theme_bw() +
  theme(text = element_text(size = 30)) +
  labs(title = "Physiological Experience vs. General Moral Concern: RAW SCORES\n",
       x = "\nMR1 factor score (physiological)",
       y = "General moral concern\n")
#   annotate("text", x = 0, y = d_moral_merged_n, size = 5, hjust = 0.5,
#        label = paste0("Pearson's r = ", round(rp_MR1.gen$estimate, 2),
#                       ", p = ", round(rp_MR1.gen$p.value, 3)))

ggplot(aes(x = MR2, y = concern_general, fill = condition), data = d_moral_merged) +
  geom_smooth(method = "lm", alpha = 0.1, aes(colour = condition)) +
  geom_point(shape = 21, colour = "black", 
             alpha = 0.5, size = 3, stroke = 1) +
  theme_bw() +
  theme(text = element_text(size = 30)) +
  labs(title = "Social-emotional Experience vs. General Moral Concern: RAW SCORES\n",
       x = "\nMR2 factor score (social-emotional)",
       y = "General moral concern\n")
#   annotate("text", x = 0, y = d_moral_merged_n, size = 5, hjust = 0.5,
#        label = paste0("Pearson's r = ", round(rp_MR2.gen$estimate, 2),
#                       ", p = ", round(rp_MR2.gen$p.value, 3)))

ggplot(aes(x = MR3, y = concern_general, fill = condition), data = d_moral_merged) +
  geom_smooth(method = "lm", alpha = 0.1, aes(colour = condition)) +
  geom_point(shape = 21, colour = "black", 
             alpha = 0.5, size = 3, stroke = 1) +
  theme_bw() +
  theme(text = element_text(size = 30)) +
  labs(title = "Perceptual-cognitive Experience vs. General Moral Concern: RAW SCORES\n",
       x = "\nMR3 factor score (perceptual-cognitive)",
       y = "General moral concern\n")
#   annotate("text", x = 0, y = d_moral_merged_n, size = 5, hjust = 0.5,
#        label = paste0("Pearson's r = ", round(rp_MR3.gen$estimate, 2),
#                       ", p = ", round(rp_MR3.gen$p.value, 3)))
```

```{r plots general raw all, message = F, echo = F, fig.width = 16, fig.height = 13}
d_moral_merged_long <- d_moral_merged %>%
  gather(factor, score, MR1:MR3) %>%
  mutate(factor = factor(factor, labels = c("Physio", "Soc-Emo", "Per-Cog")))

ggplot(aes(x = score, y = concern_general, fill = condition), data = d_moral_merged_long) +
  facet_grid(~ factor) +
  geom_smooth(method = "lm", alpha = 0.1, aes(colour = condition)) +
  geom_point(shape = 21, colour = "black", 
             alpha = 0.5, size = 3, stroke = 1) +
  theme_bw() +
  theme(text = element_text(size = 30),
        legend.position = "bottom") +
  labs(x = "\nFactor score\n",
       y = "General moral concern\n",
       color = "Condition: ",
       fill = "Condition: ")

# histograms of factor scores by condition and factor
ggplot(d_moral_merged, aes(x = MR1, fill = condition)) +
  geom_histogram(data = subset(d_moral_merged, condition == "beetle"), alpha = 0.6) +
  geom_histogram(data = subset(d_moral_merged, condition == "robot"), alpha = 0.6) +
  xlim(-3, 5)

ggplot(d_moral_merged, aes(x = MR2, fill = condition)) +
  geom_histogram(data = subset(d_moral_merged, condition == "beetle"), alpha = 0.6) +
  geom_histogram(data = subset(d_moral_merged, condition == "robot"), alpha = 0.6) +
  xlim(-3, 5)

ggplot(d_moral_merged, aes(x = MR3, fill = condition)) +
  geom_histogram(data = subset(d_moral_merged, condition == "beetle"), alpha = 0.6) +
  geom_histogram(data = subset(d_moral_merged, condition == "robot"), alpha = 0.6) +
  xlim(-3, 5)
```


```{r plots general rank, message = F, echo = F, fig.width = 16, fig.height = 13}
# ranks
ggplot(aes(x = rank(MR1), y = rank(concern_general), 
           fill = condition, group = condition), data = d_moral_merged) +
  geom_smooth(method = "lm", alpha = 0.1) +
  geom_point(shape = 21, colour = "black", 
             alpha = 0.5, size = 3, stroke = 1) +
  theme_bw() +
  theme(text = element_text(size = 30)) +
  labs(title = "Physiological Experience vs. General Moral Concern: RANKS\n",
       x = "\nMR1 factor score ranking (physiological)",
       y = "General moral concern ranking\n")
#   annotate("text", x = d_moral_merged_n, y = 18, size = 5, hjust = 1,
#        label = paste0("Spearman's rho = ", round(rs_MR1.genrank$estimate, 2),
#                       ", p = ", round(rs_MR1.genrank$p.value, 3)))

ggplot(aes(x = rank(MR2), y = rank(concern_general), 
           fill = condition, group = condition), data = d_moral_merged) +
  geom_smooth(method = "lm", alpha = 0.1) +
  geom_point(shape = 21, colour = "black", 
             alpha = 0.5, size = 3, stroke = 1) +
  theme_bw() +
  theme(text = element_text(size = 30)) +
  labs(title = "Social-emotional Experience vs. General Moral Concern: RANKS\n",
       x = "\nMR2 factor score ranking (social-emotional)",
       y = "General moral concern ranking\n")
#   annotate("text", x = d_moral_merged_n, y = 18, size = 5, hjust = 1,
#        label = paste0("Spearman's rho = ", round(rs_MR2.genrank$estimate, 2),
#                       ", p = ", round(rs_MR2.genrank$p.value, 3)))

ggplot(aes(x = rank(MR3), y = rank(concern_general),
           fill = condition, group = condition), data = d_moral_merged) +
  geom_smooth(method = "lm", alpha = 0.1) +
  geom_point(shape = 21, colour = "black", 
             alpha = 0.5, size = 3, stroke = 1) +
  theme_bw() +
  theme(text = element_text(size = 30)) +
  labs(title = "Perceptual-cognitive Experience vs. General Moral Concern: RANKS\n",
       x = "\nMR3 factor score ranking (perceptual-cognitive)",
       y = "General moral concern ranking\n")
#   annotate("text", x = d_moral_merged_n, y = 18, size = 5, hjust = 1,
#          label = paste0("Spearman's rho = ", round(rs_MR3.genrank$estimate, 2),
#                         ", p = ", round(rs_MR3.genrank$p.value, 3)))

```

## Regressions with general moral concern

```{r regressions general, message = F, echo = F, fig.width = 16, fig.height = 13}
# set contrasts (effect-code)
contrasts(d_moral_merged$condition) <- cbind(robot = c(-1, 1))
contrasts(d_moral_merged$race_cat2) <- cbind(white = c(-1, 1))
contrasts(d_moral_merged$religion_cat2) <- cbind(JC = c(1, -1, 0),
                                                 other = c(0, -1, 1))

# centered
# r1 <- lm(concern_general ~ scale(MR1, scale = F) + scale(MR2, scale = F) + 
#            scale(MR3, scale = F) + condition,
#          data = d_moral_merged)
# r2 <- lm(concern_general ~ (scale(MR1, scale = F) + scale(MR2, scale = F) + 
#            scale(MR3, scale = F)) * condition,
#          data = d_moral_merged)
# r3 <- lm(concern_general ~ (scale(MR1, scale = F) + scale(MR2, scale = F) + 
#            scale(MR3, scale = F) + condition)^2,
#          data = d_moral_merged)
# r4 <- lm(concern_general ~ (scale(MR1, scale = F) + scale(MR2, scale = F) + 
#            scale(MR3, scale = F))^2 * condition,
#          data = d_moral_merged)
# r5 <- lm(concern_general ~ (scale(MR1, scale = F) + scale(MR2, scale = F) + 
#            scale(MR3, scale = F))^3 * condition,
#          data = d_moral_merged)
# r6 <- lm(concern_general ~ (scale(MR1, scale = F) + scale(MR2, scale = F) + 
#            scale(MR3, scale = F) + condition)^3,
#          data = d_moral_merged)

r1_raw <- lm(concern_general ~ MR1 + MR2 + MR3 + condition, 
             data = d_moral_merged)
r2_raw <- lm(concern_general ~ (MR1 + MR2 + MR3) * condition, 
             data = d_moral_merged)
r3_raw <- lm(concern_general ~ (MR1 + MR2 + MR3 + condition)^2, 
             data = d_moral_merged)
r4_raw <- lm(concern_general ~ (MR1 + MR2 + MR3)^2 * condition, 
             data = d_moral_merged)
r5_raw <- lm(concern_general ~ (MR1 + MR2 + MR3)^3 * condition, 
             data = d_moral_merged)
r6_raw <- lm(concern_general ~ (MR1 + MR2 + MR3 + condition)^3, 
             data = d_moral_merged)
anova(r1_raw, r2_raw, r3_raw, r4_raw, r5_raw, r6_raw)
# summary(r1_raw)
# summary(r2_raw)
summary(r3_raw)
# summary(r4_raw)
# summary(r5_raw)
# summary(r6_raw)

r7_raw <- lm(concern_general ~ (MR1 + MR2 + condition)^2, 
             data = d_moral_merged)
r8_raw <- lm(concern_general ~ (MR1 + MR2)^2 * condition, 
             data = d_moral_merged)
r9_raw <- lm(concern_general ~ (MR1 + MR2 + condition)^3, 
             data = d_moral_merged)
anova(r7_raw, r8_raw, r9_raw)
anova(r7_raw, r3_raw)

summary(r7_raw)

ggplot(aes(x = MR2, y = concern_general, 
           # fill = MR1, 
           fill = cut(MR1, 2), 
           # group = factor(mean_MR1), # tricky to decide which is best!!
           # group = median_MR1, 
           group = cut(MR1, 2), 
           # group = condition, 
           shape = condition), 
       data = d_moral_merged) +
  # facet_wrap(~condition) +
  geom_smooth(method = "lm", alpha = 0.1, 
              # aes(colour = factor(mean_MR1))
              # aes(colour = median_MR1)
              aes(colour = cut(MR1, 2))
              # aes(colour = condition)
              ) +
  geom_point(colour = "black", alpha = 0.5, size = 5, stroke = 1) +
  scale_shape_manual(values = c(21, 23), name = "Condition") +
  scale_fill_manual(values = c("blue", "red"),
                    name = "MR1 (physiological)") +
  scale_colour_manual(values = c("blue", "red"),
                    name = "MR1 (physiological)") +
  theme_bw() +
  theme(text = element_text(size = 30)) +
  labs(title = "Interaction: MR1 * MR2\n",
       x = "\nMR2 (social-emotional)",
       y = "General moral concern\n")

ggplot(aes(x = MR2, y = concern_general, 
           fill = condition, 
           group = condition), 
       data = d_moral_merged) +
  geom_smooth(method = "lm", alpha = 0.1, 
              # aes(colour = median_MR1)
              aes(colour = condition)
              ) +
  geom_point(colour = "black", alpha = 0.5, size = 5, stroke = 1, shape = 21) +
#   scale_fill_manual(values = c("blue", "red"),
#                     name = "Condition") +
#   scale_colour_manual(values = c("blue", "red"),
#                     name = "Condition") +
  theme_bw() +
  theme(text = element_text(size = 30)) +
  labs(title = "Interaction: MR2 * Condition\n",
       x = "\nMR2 (social-emotional)",
       y = "General moral concern\n")

# ggplot(aes(x = MR1, y = concern_general, 
#            fill = cut(MR2, 3), group = cut(MR2, 3)), data = d_moral_merged) +
#   geom_smooth(method = "lm", alpha = 0.1) +
#   geom_point(shape = 21, colour = "black", 
#              alpha = 0.5, size = 5, stroke = 1) +
#   # scale_fill_continuous(low = "blue", high = "red") +
#   theme_bw() +
#   theme(text = element_text(size = 30)) +
#   labs(title = "Interactions\n",
#        x = "\nMR1 (physiological)",
#        y = "General moral concern\n")



# ranks
r1_rank <- lm(concern_general ~ rank(MR1) + rank(MR2) + rank(MR3) + condition, 
         data = d_moral_merged)
r2_rank <- lm(concern_general ~ (rank(MR1) + rank(MR2) + rank(MR3)) * condition, 
         data = d_moral_merged)
r3_rank <- lm(concern_general ~ (rank(MR1) + rank(MR2) + rank(MR3) + condition)^2, 
         data = d_moral_merged)
r4_rank <- lm(concern_general ~ (rank(MR1) + rank(MR2) + rank(MR3))^2 * condition,
         data = d_moral_merged)
r5_rank <- lm(concern_general ~ ((rank(MR1) + rank(MR2) + rank(MR3))^3) * condition,
         data = d_moral_merged)
r6_rank <- lm(concern_general ~ ((rank(MR1) + rank(MR2) + rank(MR3) + condition)^3),
         data = d_moral_merged)
anova(r1_rank, r2_rank, r3_rank, r4_rank, r5_rank, r6_rank)
summary(r1_rank)
# summary(r2_rank)
# summary(r3_rank)
# summary(r4_rank)
# summary(r5_rank)
# summary(r6_rank)

ggplot(aes(x = rank(MR2), y = concern_general, 
           fill = rank(MR1), 
           # group = mean_MR1, # tricky to decide which is best!!
           # group = median_MR1, 
           group = cut(rank(MR1), 2), 
           # group = condition, 
           shape = condition), 
       data = d_moral_merged) +
  # facet_wrap(~condition) +
  geom_smooth(method = "lm", alpha = 0.1, 
              # aes(colour = mean_MR1)
              # aes(colour = median_MR1)
              aes(colour = cut(rank(MR1), 2))
              # aes(colour = condition)
              ) +
  geom_point(colour = "black", alpha = 0.5, size = 5, stroke = 1) +
  scale_shape_manual(values = c(21, 23), name = "Condition") +
  scale_fill_continuous(low = "blue", high = "red",
                    name = "MR1 (physiological)") +
  scale_colour_manual(values = c("blue", "red"),
                    name = "MR1 (physiological)") +
  theme_bw() +
  theme(text = element_text(size = 30)) +
  labs(title = "Interaction\n",
       x = "\nMR2 (social-emotional)",
       y = "General moral concern\n")


# logs
r1 <- lm(concern_general ~ log(MR1 + 10) + log(MR2 + 10) + log(MR3 + 10) + condition, 
         data = d_moral_merged)
r2 <- lm(concern_general ~ (log(MR1 + 10) + log(MR2 + 10) + log(MR3 + 10)) * condition, 
         data = d_moral_merged)
r3 <- lm(concern_general ~ (log(MR1 + 10) + log(MR2 + 10) + log(MR3 + 10) + condition)^2, 
         data = d_moral_merged)
r4 <- lm(concern_general ~ (log(MR1 + 10) + log(MR2 + 10) + log(MR3 + 10))^2 * condition,
         data = d_moral_merged)
r5 <- lm(concern_general ~ ((log(MR1 + 10) + log(MR2 + 10) + log(MR3 + 10))^3) * condition,
         data = d_moral_merged)
r6 <- lm(concern_general ~ ((log(MR1 + 10) + log(MR2 + 10) + log(MR3 + 10) + condition)^3),
         data = d_moral_merged)
anova(r1, r2, r3, r4, r5, r6)
# anova(r1, r4)
summary(r1)
summary(r2)
summary(r3)
summary(r4)
summary(r5)
summary(r6)

ggplot(aes(x = log(MR2 + 10), y = concern_general, 
           fill = log(MR1 + 10), 
           # group = mean_MR1, # tricky to decide which is best!!
           # group = median_MR1, 
           group = cut(log(MR1 + 10), 2), 
           # group = condition, 
           shape = condition), 
       data = d_moral_merged) +
  # facet_wrap(~condition) +
  geom_smooth(method = "lm", alpha = 0.1, 
              # aes(colour = mean_MR1 + 10)
              # aes(colour = median_MR1 + 10)
              aes(colour = cut(log(MR1 + 10), 2))
              # aes(colour = condition)
              ) +
  geom_point(colour = "black", alpha = 0.5, size = 5, stroke = 1) +
  scale_shape_manual(values = c(21, 23), name = "Condition") +
  scale_fill_continuous(low = "blue", high = "red",
                    name = "MR1 (physiological)") +
  scale_colour_manual(values = c("blue", "red"),
                    name = "MR1 (physiological)") +
  theme_bw() +
  theme(text = element_text(size = 30)) +
  labs(title = "Interaction\n",
       x = "\nMR2 (social-emotional)",
       y = "General moral concern\n")
```

## Start messing with specific moral concern

```{r regressions specific, message = F, echo = F}
# make longform dataset
d_moral_merged3 <- d_moral_merged %>%
  gather(concern_item, concern_score, starts_with("concern")) %>%
  filter(concern_item != "concern_general") %>%
  mutate(concern_type = factor(gsub("concern_", "", 
                                    substr(concern_item, 1, 11))))

# effect code with oth as base
contrasts(d_moral_merged3$concern_type) <- cbind(phy = c(-1, 0, 1, 0),
                                       soc = c(-1, 0, 0, 1),
                                       per = c(-1, 1, 0 ,0))

# regressions: raw scores
r1_spec_raw <- lmer(concern_score ~ MR1 + MR2 + MR3 + concern_type + condition + (1 | subid), data = d_moral_merged3)
r2_spec_raw <- lmer(concern_score ~ (MR1 + MR2 + MR3) * concern_type + condition + (1 | subid), data = d_moral_merged3)
r3_spec_raw <- lmer(concern_score ~ (MR1 + MR2 + MR3 + concern_type)^2 + condition + (1 | subid), data = d_moral_merged3)
r4_spec_raw <- lmer(concern_score ~ (MR1 + MR2 + MR3 + concern_type + condition)^2 + (1 | subid), data = d_moral_merged3)
r5_spec_raw <- lmer(concern_score ~ (MR1 + MR2 + MR3 + concern_type)^2 * condition + (1 | subid), data = d_moral_merged3)
r6_spec_raw <- lmer(concern_score ~ (MR1 + MR2 + MR3 + concern_type + condition)^3 + (1 | subid), data = d_moral_merged3)
r7_spec_raw <- lmer(concern_score ~ (MR1 + MR2 + MR3 + concern_type)^3 * condition + (1 | subid), data = d_moral_merged3)

anova(r1_spec_raw, r2_spec_raw, r3_spec_raw, r4_spec_raw, r5_spec_raw, r6_spec_raw, r7_spec_raw)
# summary(r1_spec_raw)
# summary(r2_spec_raw)
# summary(r3_spec_raw)
# summary(r4_spec_raw)
# summary(r5_spec_raw)
summary(r6_spec_raw)
# summary(r7_spec_raw)
```

## Plots with specific moral concern

```{r plots specific, message = F, echo = F, fig.width = 16, fig.height = 5}
# raw scores
ggplot(aes(x = MR1, y = concern_score,
           fill = condition, group = condition), data = d_moral_merged3) +
  geom_smooth(method = "lm", alpha = 0.1) +
  facet_grid(~ concern_type) +
  geom_point(shape = 21, colour = "black", 
             alpha = 0.5, size = 3, stroke = 1) +
  theme_bw() +
  theme(text = element_text(size = 20)) +
  labs(title = "Physiological Experience vs. General Moral Concern: RAW SCORES\n",
       x = "\nMR1 factor score (physiological)",
       y = "How bad would you feel for the [target]?\n")

ggplot(aes(x = MR2, y = concern_score,
       fill = condition, group = condition), data = d_moral_merged3) +
  geom_smooth(method = "lm", alpha = 0.1) +
  facet_grid(~ concern_type) +
  geom_point(shape = 21, colour = "black", 
             alpha = 0.5, size = 3, stroke = 1) +
  theme_bw() +
  theme(text = element_text(size = 20)) +
  labs(title = "Social-emotional Experience vs. General Moral Concern: RAW SCORES\n",
       x = "\nMR2 factor score (social-emotional)",
       y = "How bad would you feel for the [target]?\n")

ggplot(aes(x = MR3, y = concern_score,
       fill = condition, group = condition), data = d_moral_merged3) +
  geom_smooth(method = "lm", alpha = 0.1) +
  facet_grid(~ concern_type) +
  geom_point(shape = 21, colour = "black", 
             alpha = 0.5, size = 3, stroke = 1) +
  theme_bw() +
  theme(text = element_text(size = 20)) +
  labs(title = "Perceptual-cognitive Experience vs. General Moral Concern: RAW SCORES\n",
       x = "\nMR3 factor score (perceptual-cognitive)",
       y = "How bad would you feel for the [target]?\n")

# ranks
ggplot(aes(x = rank(MR1), y = concern_score,
       fill = condition, group = condition), data = d_moral_merged3) +
  facet_grid(~ concern_type) +
  geom_smooth(method = "lm", alpha = 0.1) +
  geom_point(shape = 21, colour = "black", 
             alpha = 0.5, size = 3, stroke = 1) +
  theme_bw() +
  theme(text = element_text(size = 20)) +
  labs(title = "Physiological Experience vs. General Moral Concern: RANKS\n",
       x = "\nrank(MR1) factor score ranking (physiological)",
       y = "How bad would you feel for the [target]?\n")

ggplot(aes(x = rank(MR2), y = concern_score,
       fill = condition, group = condition), data = d_moral_merged3) +
  facet_grid(~ concern_type) +
  geom_smooth(method = "lm", alpha = 0.1) +
  geom_point(shape = 21, colour = "black",  
             alpha = 0.5, size = 3, stroke = 1) +
  theme_bw() +
  theme(text = element_text(size = 20)) +
  labs(title = "Social-emotional Experience vs. General Moral Concern: RANKS\n",
       x = "\nrank(MR2) factor score ranking (social-emotional)",
       y = "How bad would you feel for the [target]?\n")

ggplot(aes(x = rank(MR3), y = concern_score,
       fill = condition, group = condition), data = d_moral_merged3) +
  facet_grid(~ concern_type) +
  geom_smooth(method = "lm", alpha = 0.1) +
  geom_point(shape = 21, colour = "black", 
             alpha = 0.5, size = 3, stroke = 1) +
  theme_bw() +
  theme(text = element_text(size = 20)) +
  labs(title = "Perceptual-cognitive Experience vs. General Moral Concern: RANKS\n",
       x = "\nrank(MR3) factor score ranking (perceptual-cognitive)",
       y = "How bad would you feel for the [target]?\n")

```

